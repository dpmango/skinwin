(function(){var t;t=window,document,Number.prototype.degree=function(){return this*Math.PI/180},t.CnvRoulette2=function(){function t(t){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.objects=[],this.patterns={},this.P={centerX:this.canvas.width/2,centerY:this.canvas.height/2,R:this.canvas.width/2-2,speed:5,slowdown_step:.5,minSpeed:1}}return t.prototype.init=function(t){var e,s,i,h,n,a;for(i=h=0,n=t.length;h<n;i=++h)a=t[i],e=document.createElement("canvas"),e.width=60,e.height=60,s=e.getContext("2d"),s.translate(e.width/2,e.height/2),s.rotate((360*i/t.length).degree()),s.translate(-e.width/2,-e.height/2),s.fillStyle="transparent","sw"===a?s.strokeStyle="#11bfae":0===a?s.fillStyle="#11bfae":s.strokeStyle=i%2==0?"#132434":"#e00a0b",s.beginPath(),s.lineWidth=2,s.arc(e.width/2,50,40,240..degree(),300..degree()),s.arc(e.width/2,87,40,285..degree(),255..degree(),-1),s.closePath(),s.stroke(),s.fill(),s.fillStyle="#fff",s.font="13pt Montserrat",s.textAlign="center",s.textBaseline="middle",s.fillText(a,e.width/2,e.height/2),this.objects[i]={cache:s,val:a,angle:360*i/t.length};this._d=Math.ceil(360/(2*t.length)),this.status="init",this.draw(!1)},t.prototype.start=function(){if("init"===this.status||"stop"===this.status)return this._s=0,this.winner_angle=null,this.P.speed=4,this.status="spin",this.draw()},t.prototype.stop=function(t,e){var s,i,h,n,a,r;for(this.afterStop=e,this.status="slowdown",i=Math.floor(this.P.speed/this.P.slowdown_step),r=this.objects,s=h=0,n=r.length;h<n;s=++h)a=r[s],a.val===t&&null===this.winner_angle&&(this.winner_angle=a.angle);return console.log(this.winner_angle),this.slowDownTimer=setInterval(function(t){return function(){if(i-- >0&&(t.P.speed-=t.P.slowdown_step,t.P.speed<t.P.minSpeed))return t.P.speed=t.P.minSpeed}}(this),800)},t.prototype.drawBg=function(){this.ctx.beginPath(),this.ctx.strokeStyle="#ffd800",this.ctx.lineWidth=6,this.ctx.arc(this.canvas.width/2,this.canvas.height/2,this.P.R,0,2*Math.PI,-1),this.ctx.stroke()},t.prototype.drawVals=function(){var t,e,s,i,h,n,a;for(this.ctx.shadowBlur=0,h=this.objects,t=e=0,s=h.length;e<s;t=++e)i=h[t],n=(this.P.R-36)*Math.cos((22.5*t-90).degree())+this.canvas.width/2-30,a=(this.P.R-36)*Math.sin((22.5*t-90).degree())+this.canvas.height/2-30,this.ctx.drawImage(i.cache.canvas,n,a)},t.prototype.draw=function(t){var e;if(null==t&&(t=!0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBg(),this.drawVals(),"slowdown"===this.status&&this.P.speed===this.P.minSpeed&&this.winner_angle===Math.floor(360-this._s-2)&&(clearInterval(this.slowDownTimer),this.status="stop","function"==typeof this.afterStop&&this.afterStop()),"spin"!==this.status&&"slowdown"!==this.status||(this.ctx.translate(this.canvas.width/2,this.canvas.height/2),this.ctx.rotate(this.P.speed.degree()),this.ctx.translate(-this.canvas.width/2,-this.canvas.height/2),this._s+=this.P.speed,this._s>=360&&(this._s=0)),("slowdown"===this.status||"spin"===this.status)&&t)return e=function(t){return function(){return t.draw()}}(this),requestAnimationFrame(e)},t}()}).call(this);