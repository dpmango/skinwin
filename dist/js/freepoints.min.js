(function(){var t,i={}.hasOwnProperty;t=window,document,t.CnvRoulette3=function(){function t(t){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.objects=[],this.patterns={},this.P={background:"images/roulette-bg2.png",centerX:this.canvas.width/2,centerY:this.canvas.height/2,chip:{width:156,height:82,amount:9},speed:20,slowdown_step:3,minSpeed:4}}return t.prototype.init=function(t){var s,e,h,n,r,a,o,c;if(h=t.length,this.P.chip.amount>h)for(r=n=o=h,c=this.P.chip.amount;o<=c?n<c:n>c;r=o<=c?++n:--n)s=r%h,t.push(JSON.parse(JSON.stringify(t[s])));for(e in t)i.call(t,e)&&(a=t[e],this.objects[e]=this.createPlayerObj(a,e));this._l=this.objects.length,this._d=0,this.winner_id=null,this.addPattern(this.P.background),this.status="init"},t.prototype.start=function(){if("init"===this.status||"stop"===this.status)return this.winner_id=null,this.P.speed=20,this.status="spin",this.draw()},t.prototype.stop=function(t,i){var s,e,h,n;for(this.afterStop=i,this.status="slowdown",e=Math.floor(this.P.speed/this.P.slowdown_step),s=h=0,n=this.objects.length;0<=n?h<n:h>n;s=0<=n?++h:--h)this.objects[s].id===t&&null===this.winner_id&&(this.winner_id=s);return this.slowDownTimer=setInterval(function(t){return function(){if(e-- >0&&(t.P.speed-=t.P.slowdown_step,t.P.speed<t.P.minSpeed))return t.P.speed=t.P.minSpeed}}(this),1e3)},t.prototype.addPattern=function(t){var i;if(void 0===this.patterns[t])return this.patterns[t]=!1,i=new Image,i.onload=function(s){return function(){return s.patterns[t]=i,s.draw(!1)}}(this),i.src=t},t.prototype.createPlayerObj=function(t,i){return this.addPattern(t.picture),this.addPattern(t.big_picture),{id:t.id,num:i,color:t.color,picture:t.picture,big_picture:t.big_picture,gray_picture:t.gray_picture,x:(i-1)*this.P.chip.width}},t.prototype.toGray=function(){var t,i,s,e;for(e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),i=e.data,s=0;s<i.length;)t=.34*i[s]+.5*i[s+1]+.16*i[s+2],i[s]=t,i[s+1]=t,i[s+2]=t,s+=4;this.ctx.putImageData(e,0,0)},t.prototype.drawPlayer=function(t,i){if(this.patterns[i.picture])return this.ctx.drawImage(this.patterns[i.picture],t+(this.P.chip.width-this.patterns[i.picture].naturalWidth)/2,(this.canvas.height-this.patterns[i.picture].naturalHeight)/2+20,this.patterns[i.picture].naturalWidth,this.patterns[i.picture].naturalHeight)},t.prototype.drawPointer=function(t){var i;return null==t&&(t=.1),i=5,t>1&&(t=1),this.ctx.fillStyle="rgba(255, 216, 0, "+t+")",this.ctx.shadowBlur=10,this.ctx.shadowColor="#000000",this.ctx.shadowOffsetX=5,this.ctx.shadowOffsetY=5,this.ctx.beginPath(),this.ctx.moveTo(this.P.centerX-28,i),this.ctx.lineTo(this.P.centerX+28,i),this.ctx.lineTo(this.P.centerX,52+i),this.ctx.closePath(),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0},t.prototype.drawBg=function(){if(this.patterns[this.P.background])return this.ctx.drawImage(this.patterns[this.P.background],(this.canvas.width-this.patterns[this.P.background].naturalWidth)/2,42,this.patterns[this.P.background].naturalWidth,109)},t.prototype.draw=function(t){var i,s,e,h,n,r,a;if(null==t&&(t=!0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBg(),this.drawPointer(1),("spin"===this.status||"slowdown"===this.status)&&(this._d+=this.P.speed,this._d>=this.P.chip.width)){for(this._d=0,e=this.objects[this.objects.length-1].x,this.objects[this.objects.length-1].x=this.objects[0].x,s=h=0,r=this.objects.length-2;0<=r?h<r:h>r;s=0<=r?++h:--h)this.objects[s].x=this.objects[s+1].x;this.objects[this.objects.length-2].x=e}for("slowdown"===this.status&&(this.P.speed<=this.P.minSpeed&&this.objects[this.winner_id].x+1.5*this.P.chip.width+this._d>=this.P.centerX&&this.objects[this.winner_id].x+this.P.chip.width/2+this._d<=this.P.centerX&&(this.P.speed=1,clearInterval(this.slowDownTimer)),1===this.P.speed&&this.objects[this.winner_id].x+this.P.chip.width/2+this._d>=this.P.centerX&&(this.status="stop","function"==typeof this.afterStop&&this.afterStop())),s=n=0,a=this.objects.length;0<=a?n<a:n>a;s=0<=a?++n:--n)this.drawPlayer(this.objects[s].x+this._d,this.objects[s],1);if(this.drawPointer(1),("slowdown"===this.status||"spin"===this.status||"winner_showing"===this.status)&&t)return i=function(t){return function(){return t.draw()}}(this),requestAnimationFrame(i)},t}()}).call(this);